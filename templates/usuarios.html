<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Admin - Usuarios</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<div class="admin-container">
    <h2 class="admin-title">GESTI√ìN DE USUARIOS</h2>
    
    <div class="top-actions">
        <a href="/admin" class="btn-back">‚Üê Volver</a>
        <button class="btn-add" onclick="document.getElementById('modalCrear').style.display='flex'">+ Nuevo Usuario</button>
    </div>

    {% with messages = get_flashed_messages() %}
        {% if messages %} <div class="msg-success">{{ messages[0] }}</div> {% endif %}
    {% endwith %}

    <table class="admin-table">
        <thead>
            <tr>
                <th style="width: 50px;">ID</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Email</th>
                <th>Contrase√±a</th>
                <th>Saldo</th>
                <th style="width: 120px;">Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for u in usuarios %}
            <tr>
                <td>{{ u.id_usuario }}</td>
                <td>{{ u.nombre }}</td>
                <td>{{ u.apellido }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.contrase√±a }}</td>
                <td style="font-weight:bold; color:var(--accent);">$ {{ "%.2f"|format(u.saldo) }}</td>
                <td>
                    <div class="action-container">
                        <button class="btn-icon btn-edit" onclick="abrirEditar('{{u.id_usuario}}', '{{u.nombre}}', '{{u.apellido}}', '{{u.email}}', '{{u.contrase√±a}}', '{{u.saldo}}')">‚úèÔ∏è</button>
                        <a href="/eliminar_usuario/{{ u.id_usuario }}" class="btn-icon btn-delete-user" onclick="return confirm('¬øBorrar este usuario permanentemente?')">üóëÔ∏è</a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="modalCrear" class="modal-overlay">
    <div class="modal-box">
        <span class="close-btn" onclick="document.getElementById('modalCrear').style.display='none'">√ó</span>
        <h3 style="color: #28a745; text-align: center;">Nuevo Usuario</h3>
        <form action="/admin/crear_usuario" method="POST">
            <div class="form-grid">
                <div class="form-group"><label>Nombre</label><input type="text" name="nombre" required></div>
                <div class="form-group"><label>Apellido</label><input type="text" name="apellido" required></div>
                <div class="form-group"><label>Email</label><input type="email" name="email" required></div>
                <div class="form-group"><label>Contrase√±a</label><input type="text" name="contrase√±a" required></div>
                <div class="form-group"><label>Saldo Inicial ($)</label><input type="number" name="saldo" step="0.01" required></div>
            </div>
            <button type="submit" class="btn-save" style="background:#28a745; color:white; margin-top:20px;">CREAR USUARIO</button>
        </form>
    </div>
</div>

<div id="modalEditar" class="modal-overlay">
    <div class="modal-box">
        <span class="close-btn" onclick="document.getElementById('modalEditar').style.display='none'">√ó</span>
        <h3 style="color: var(--accent); text-align: center;">Editar Usuario</h3>
        <form id="formEditar" action="" method="POST">
            <div class="form-grid">
                <div class="form-group"><label>Nombre</label><input type="text" name="nombre" id="edit_nombre" required></div>
                <div class="form-group"><label>Apellido</label><input type="text" name="apellido" id="edit_apellido" required></div>
                <div class="form-group"><label>Email</label><input type="email" name="email" id="edit_email" required></div>
                <div class="form-group"><label>Contrase√±a</label><input type="text" name="contrase√±a" id="edit_contrase√±a" required></div>
                <div class="form-group"><label>Saldo ($)</label><input type="number" name="saldo" id="edit_saldo" step="0.01" required></div>
            </div>
            <button type="submit" class="btn-save" style="margin-top:20px;">GUARDAR CAMBIOS</button>
        </form>
    </div>
</div>

<script>
    function abrirEditar(id, nombre, apellido, email, password, saldo) {
        document.getElementById('modalEditar').style.display = 'flex';
        document.getElementById('edit_nombre').value = nombre;
        document.getElementById('edit_apellido').value = apellido;
        document.getElementById('edit_email').value = email;
        document.getElementById('edit_contrase√±a').value = password;
        document.getElementById('edit_saldo').value = saldo;
        document.getElementById('formEditar').action = "/editar_usuario/" + id;
    }
    
    // Cerrar al hacer clic fuera
    window.onclick = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            event.target.style.display = 'none';
        }
    }
</script>

</body>
</html>